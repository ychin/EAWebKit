<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>PPMalloc Changes</title>
  <meta content="text/html; charset=us-ascii" http-equiv="Content-Type">
  <meta name="author" content="Paul Pedriana">
  <meta name="description" content="Describes changes between EASTL versions.">
  <style type="text/css">
    .small {
        font-size: smaller
    }
    .code {
        font-family: "Courier New", Courier, mono;
        font-size: 9pt;
    }
    .codeComment {
        font-family: "Courier New", Courier, mono; 
        font-size: 9pt;
        color: #339933; 
    }
  </style>
</head>


<body>
<h1>PPMalloc Changes</h1>

<p><span style="font-weight: bold;">Version 1.26.11</span></p>
<p>Changes:</p>
<ul>
    <li>Fixing android test driver.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.10</span></p>
<p>Changes:</p>
<ul>
    <li>#sys - PPMalloc GeneralAllocator::MallocAligned(...) missing PPMMutexUnlock call when using kOptionLockDuringHookCalls.</li>
    <li>Memory leak callstacks now attempt to print out source file and line information when available.</li>
    <li>fixing pc32 build farm compiler error due to missing a fwd dec.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.09</span></p>
<p>Changes:</p>
<ul>
    <li>#sys - PPMalloc PS4 UBSAN warning supression.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.08</span></p>
<p>Changes:</p>
<ul>
    <li>Resolving build breaks due to C++17 operator new/delete changes</li>
    <li>Fixing DLL export issue with Mutex.h</li>
    <li>Gemini to Xbsx.</li>
    <li>Adding support for timed mutex locking.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.07</span></p>
<p>Changes:</p>
<ul>
    <li>Updated to support PS5 0.9 SDK.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.06</span> (Oct 8, 2019)</p>
<p>Changes:</p>
<ul>
    <li>Convert from EA::Thread::GetCallstack() to EA::Callstack::GetCallStack()</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.05</span> (Jun 17, 2019)</p>
<p>Changes:</p>
<ul>
  <li>Removing legacy platform support for: Marmalade/Airplay, Xenon, PS3, Playbook, and SamsungTV.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.04</span> (May 30, 2019)</p>
<p>Changes:</p>
<ul>
  <li>Removed the EA_WINAPI_FAMILY, EA_WINAPI_PARTITION and EA_WINAPI_FAMILY_PARTITION backward compatible defines from Config.h.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.03</span> (Apr 02, 2019)</p>
<p>Changes:</p>
<ul>
	<li>Fixing MemoryRangeCallbackFunction passing reserved size instead of core size.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.02</span> (Jan 30, 2019)</p>
<p>Changes:</p>
<ul>
	<li>Updated code to use generic SONY platform macro where possible.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.01</span> (Dec 3, 2018)</p>
<p>Changes:</p>
<ul>
	<li>Fixes incorrect usage of the comma operator in EAAllocationRecorder where a semicolon was intended instead which could generate compiler warnings.</li>
	<li>Removing lots of old platform support: PS2, PS3, Xenon, PSP2, Revolution, and many others.</li>
    <li>Updated code to use generic EA_PLATFORM_SONY where possible.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.26.00</span> (Jan 29, 2018)</p>
<p>Changes:</p>
<ul>
	<li>PPMalloc's PPMAtomicIncrement now uses EAThread's freestanding function EA::Thread::AtomicFetchIncrement instead of casting the type to an AtomicUInt64 and then incrementing.</li>
	<li>Added support for an assert callback to the StackAllocator matching the functionality of other PPMalloc allocators.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.25.02</span> (Jan 12, 2018)</p>
<p>Changes:</p>
<ul>
	<li>Added AssertionFailureFunction support to StackAllocator.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.25.02</span> (Jan 12, 2018)</p>
<p>Changes:</p>
<ul>
	<li>Added AssertionFailureFunction support to StackAllocator.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.25.01</span> (December 11th, 2017)</p>
<p>Changes:</p>
<ul>
	<li>Turned on mmap support for nx.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.25.00</span> (November 10th, 2017)</p>
<p>Changes:</p>
<ul>
	<li>Added support for EAGeneralAllocator's AddCoreFunction to be able to manipulate the committed core size as well as the reserved core size.  This is an API breaking change.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.24.05</span> (October 21st, 2016)</p>
<p>Changes:</p>
<ul>
	<li>Updated Build and Initialize scripts to remove warnings generated by Framework 3.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.24.04</span> (August 10th, 2016)</p>
<p>Changes:</p>
<ul>
	<li>Fix bug in EAGeneralAllocator::GetOption() where a lock could be acquired and never released.</li>
	<li>Added the option <span class="code">kOptionEnableTrimToZero</span> for PPMalloc to explicitly trim empty cores in EAGeneralAllocator upon free.</li>
	<li>Fixed PhysicalFootprint and NumCore tracking to be more accurate.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.24.03</span> (April 7th, 2016)</p>
<p>Changes:</p>
<ul>
	<li>Fixed TrimCore and ExtendCore race conditions when executed in a multithreaded context.</li>
	<li>Fixed the GeneralAllocator to align the 'nAllocatorRequestedSize' param for calls to MallocFailureFunctions to be aligned to the allocator's page size so when adding core memory the user knows the correct size to allocate.</li>
	<li>Corrected the reported page size on Kettle when calling GetPageSize() which was returning 4KB which has now been corrected to the appropriate 16KB. (the CPU+GPU use 4KB pages but the OS only deals with 4 pages at a time giving us 16KB pages)</li>
	<li>PPMalloc now keeps track of the number of memory cores added to the allocator.</li>
	<li>Fixed a bug where the Max number of memory mapped allocations allowed was not being honoured</li>
	<li>Fixing incorrect assert affecting platforms using MMap (real MMap not VAlloc)</li>
</ul>

<p><span style="font-weight: bold;">Version 1.24.02</span> (September 25th, 2015)</p>
<p>Changes:</p>
<ul>
  <li>Fixed a warning generated when compiling with VS2015.</li>
  <li>Converted initialize.xml to structured-XML which fixes warnings generated by Framework.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.24.01</span> (July, 2015)</p>
<p>Changes:</p>
<ul>
  <li>Fixes reporting issue inside the NonLocalallocator so now it will properly report all core blocks rather than just the first core block on the first call and doing othing on any subsequent calls to ReportNext().</li>
  <li>Added telemetry methods to EAGeneralAllocator:
    <ul>
      <li>PhysicalFootprint()</li>
	  <li>size_t VirtualFootprint()</li>
	  <li>size_t CoreIncrementSize()</li>
    </ul>
  </li>
</ul>

<p><span style="font-weight: bold;">Version 1.24.00</span> (May, 2015)</p>
<p>Changes:</p>
<ul>
  <li>Resolved warnings generated when building the tests using VS2015 RC.</li>
  <li>Implemented block splitting functionality in EANonLocalAllocator.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.23.05</span> (March, 2015)</p>
<p>Changes:</p>
<ul>
  <li>Fixed memory leak on PC only when using trimmable core memory. (memory that can be partially freed)</li>
  <li>Resolved warnings generated when building the tests using VS2015.</li>
</ul>

<p><span style="font-weight: bold;">Version 1.23.04</span> (November, 2014)</p>
<p>Changes:</p>
<ul>
  <li>Fixed a crash bug on PS4 SDK 2.000.x related to SDK changes that modified behavior of kernel virtual/physical memory allocations.</li>
  
</ul>

<p><span style="font-weight: bold;">Version 1.23.03</span> (October, 2014)</p>
<p>Changes:</p>
<ul>
  <li>Integrated Frostbite changes to PPMalloc:</li>
    <ul>
      <li>Updated EANonLocalAllocators bin selection algorithm.  Reduces the number of bins to 40 and results in a more uniform distribution.</li>
      <li>Added InitWithoutCore function EANonLocalAllocators.</li>
    </ul>
</ul>

<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.23.02</span> (September, 2014)</p>
<p>Changes:</p>
<ul>
  <li>Resolved warnings that occurred on iphone-arm64 configurations.</li>
</ul>

<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.23.01</span> (June, 2014)</p>
<p>Changes:</p>
<ul>
  <li>Fixed a bug/limitation in the ScratchpadAllocator constructor in which you couldn't construct it with an initial count other than zero. Discovered by Coverity analysis. </li>
</ul>

<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.23.00</span> (February, 2014)</p>
<p>Changes:</p>
<ul>
  <li>Added kOptionEnableMallocFailureAssert, which allows you to set a heap to assert upon Malloc failure. It is off by default in order to be compatible with the standard malloc function. This resulted in adding a new error id (kGAErrorMemoryExhaustion) and associated string. </li>
  <li>Fixed a couple Coverity warnings, neither of which was likely any practical consequence to  users.</li>
  <li>Fixed a few compiler warning about registry keyword.</li>
  <li>Added ScratchpadAllocator, which allows you to have a per-thread &quot;scratchpad&quot; heap. It acts  much like alloca but is more flexible, in particular because allocation size can be dynamically determined and because there are no explicit size limits. ScratchpadAllocator works by implementing a per-thread StackAllocator and wrapping its use to make user syntax  simple, as shown below. ScratchpadAllocator was motivated by something similar in the Frostbite memory system. For more documentation see <a href="ScratchpadAllocator.html">ScratchpadAllocator.html</a>.</li>
  <blockquote>
    <pre>void DoSomething(){
    ScratchpadAllocator scratchpad;
 
    void* p1 = scratchpad.Malloc(gSize);
    void* p2 = scratchpad.MallocAligned(10, 64);
 
    scratchpad.Free(p1); // Calling Free is optional, though it allows for the 
    scratchpad.Free(p2); // potential of more efficient usage of scatch memory.
}</pre>
  </blockquote>
</ul>
<p>  <span class="code"> </span></p>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.22.00</span> (December, 2013)</p>
<p>Changes:</p>
<ul>
  <li>Added support for PlayStation4 and Xbox One.</li>
  <li>Improved performance of NonLocalAllocator by adding more bins.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.21.00</span> (Oct 7, 2013)</p>
<p>Changes:</p>
<ul>
  <li>Changed the GeneralAllocator default debug printing of file/line location (e.g. heap traces) to print the line as unsigned int instead of signed int.</li>
  <li>Fixed a bug in StackAllocator's constructor whereby if you specified an initial core size of ~0 then core function context wouldn't be set to the user-supplied value. Reported by Avery Lee. </li>
  <li>Adds a definition for the previously only declared GeneralAllocator::SetAddCoreFunction. In doing so, the CoreAddFunction typedef was given an additional parameter (coreType). This addition can't break any users because SetAddCoreFunction wasn't previously implemented.
    <pre><span class="codeComment">     /// SetAddCoreFunction
     /// Specifies a callback function to be called when a GeneralAllocator instance
     /// needs to add new core memory, or when AddCore is called with a NULL pData argument.
     /// When a CoreAddFunction is specified, it completely takes over the allocation of 
     /// new core, and if it returns NULL then no fallback code will execute to back it up.
     /// The CoreAddFunction returns the void* address of the core block and fills in the ppCoreFreeFunction and 
     /// ppCoreExtendFunction pointers and contexts which will be later used when it's time to 
     /// free or extend the core memory. *ppCoreFreeFunctionContext and *ppCoreExtendFunctionContext
     /// may be set to NULL if the CoreFreeFunction and CoreExtendFunction don't need any context
     /// information passed to them. CoreFreeFunction and CoreExtendFunction must be set or else
     /// default behavior will be used for the given platform, which may result in unexpected behavior.
     /// The CoreAddFunction must set *pReservedSize appropriately.
     /// coreType is a user-specified value that defines the type of core memory added. See enum CoreType.</span><span class="code">
     typedef void* (*CoreAddFunction)(void* userData, size_t minSize, size_t* pReservedSize, 
                                      CoreFreeFunction* ppCoreFreeFunction, void** ppCoreFreeFunctionContext, 
                                      CoreExtendFunction* ppCoreExtendFunction, void** ppCoreExtendFunctionContext,
                                      uint32_t&amp; coreType);
     void SetAddCoreFunction(CoreAddFunction pCoreAddFunction, void* pCoreAddFunctionContext);</span></pre>
  </li>
  <li>Resolved some warnings generated under recent versions of clang for ios/osx.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.20.05</span> (July 11, 2013)</p>
<p>Changes</p>
<ul>
  <li>Fixed the PPM_Log2(uint64_t x) function.The unfixed version had the effect on 64 bit platforms of making NonLocalAllocator choose non-optimal block sizes for Malloc requests. </li>
  <li>Improved NonLocalAllocator's ability to find perfectly matched blocks in terms of size/alignment. Suggested by Brian Hixon. </li>
  <li>Increased NonLocalAllocator's bin count from 8 to 12, in order to handle larger memory available in modern platforms. Suggested by Brian Hixon.</li>
  <li>Changed extras/SmallBlockAllocator's float_t usage to float, in order to be consistent with the rest of the package. In practice this will behave identically.</li>
  <li>Added SmallBlockAllocator::kHookTypeGrowHeapDisabled, which is set when the grow operation wants to acquire memory but allocator is not allowed to grow (allocs will overflow).</li>
  <li>Increased SmallBlockAllocator::Tracef's buffer size from 512 to 1024 and changed it from using vsprintf to vsnprintf. </li>
  <li>Made GeneralAllocator::GetUsableSize and GetBlockSize be static members instead of regular member functions. It turns out that they accessed only static data and locked a mutex which was irrelevant, as all it does is read the bytes of the input pointer. </li>
  <li>Added  PPM_Vsnprintf to complement  PPM_Snprintf.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.20.04</span> (April 3rd, 2013)</p>
<p>Changes</p>
<ul>
  <li>Changed <span class="small">PPM_MIN_ALIGN</span> to be 16 on 32 bit OSX, whereas previously it was 8. This is to match the OSX malloc and new implementations.</li>
  <li>Added support for unmanaged builds via  <span class="small">EA_UNMANAGED_ALIGN</span>. This fixes a problem that was introduced in an earlier version of PPMalloc.</li>
  <li>Tweaked GeneralAllocator::AddCoreInternal in such a way as to make Coverity think that pCore wasn't being leaked. The revised code is theoretically more correct anyway.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.20.03</span> (March 4, 2013)</p>
<p>Release Notes</p>
<ul>
  <li>GeneralAllocatorDebug::Malloc, MallocAligned, and Realloc entry callback hooks now report the user-requested size as opposed to the adjusted size. The change makes the code consistent with other malloc functions in GeneralAllocatorDebug and GeneralAllocator. However, some users may be affected by this is they were somehow dependent on the previous incorrect behavior in their heap reporting. If you want the actual size of the blocks allocated with these functions, you need to pay attention to the <em>exit</em> callback hook instead of the entry hook. Reported by Alexandre Fortin.</li>
</ul>
<p>Changes</p>
<ul>
  <li>Added support for filling in HookInfo::mnSizeOutput upon calling the post-event hook for Malloc, MallocAligned, etc. </li>
  <li>Added GeneralAllocator::GetMaxMallocSize.</li>
  <li>Fixed a problem where calling Malloc with a size that's higher than supported would fail late in the function instead of right up front at the beginning of Malloc.</li>
  <li>Fixed GeneralAllocatorDebug::Malloc, MallocAligned, and Realloc (Calloc not affected) to specify the user-requested size in the entry hook callback, as opposed to the potentially bumped up size. This makes it consistent with Calloc and GeneralAllocator::Malloc, etc. See the release notes, as this change may affect some users. </li>
  <li>Exposed <span class="small">PPM_NLA_MIN_ALLOC_SIZE</span> in the PPMalloc.build file so it can be tweaked in parallel with <span class="small">PPM_NLA_MIN_ALIGN</span>. However, it's recommended that instead of tweaking <span class="small">PPM_NLA_MIN_ALIGN</span> you instead simply use the NonLocalAllocator::MallocAligned function to request aligned memory. The end result is the same, but in a more flexible way. Suggested by Bogdan Sladaru.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.20.02</span> (Feburary 4th, 2013)</p>
<p>Changes</p>
<ul>
  <li>Switch core entrypoint from EATest to EAMain.</li>
  <li>Disabled callstack functionality on Android until we have a reliable implementation for it.</li>
  <li>Documentation updates.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.20.01</span> (Janurary 7th, 2013)</p>
<p>Changes</p>
<ul>
  <li>Alignment fix for the mEventId which requires 8 bytes alignment for Apple platforms, because of atomics.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.20.00</span> (December 10th, 2012)</p>
<p>Changes</p>
<ul>
  <li>Added WiiU support.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.19.02</span> (November 5th, 2012)</p>
<p>Changes</p>
<ul>
  <li>Added FixedAllocatorBase::GetAllocationFunctionContext accessor function. Suggested by Ryan Ingram. </li>
  <li>Added private copy constructor and operator= to FixedAllocatorBase in order to prevent accidental copying. Suggested by Ryan Ingram.</li>
  <li>Added code to GeneralAllocatorDebug::SetGuardSize to chop the max guard size if it's higher than what GeneralAllocatorDebug can support. </li>
  <li>Fixed an &quot;unreachable code&quot; warning in SmallBlockAllocator::Free. Submitted by Alban Wood, Yury Demendeev, Scott Wardle. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.19.01</span> (August 7, 2012)</p>
<p>Release notes:</p>
<ul>
  <li>This version of PPMalloc adds a dependency on EAThread. <br>
  Most PPMalloc users are already EAThread users, but there may be some who are not. The reason for this change is that PPMalloc has had a GetCallstack function which duplicates the one present in EAThread and has lagged on support. Similarly PPMalloc has had some mutex functionality which duplicates the functionality present in EAThread.Years ago there wasn't 100% overlap in PPMalloc and EAThread users, but now there nearly is. </li>
</ul>
<p>Changes</p>
<ul>
  <li>Updated callstack and mutex functionality to use EAThread. See the release notes for details.</li>
  <li>Added dll export declarations to some functions that didn't previously have it. This allows them to be used from PPMalloc as a DLL. </li>
  <li>Added improved WinRT (new Microsoft mobile OS variation of Windows) support.</li>
  <li>Worked around some iPhone clang compiler pedantic warnings. </li>
  <li>Fixed missing Apple (iOS, OS X) callstack support. It was supposed to be migrated from the EACallstack package but got missed.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.19.00</span> (July 3rd, 2012)</p>
<p>Release notes:</p>
<ul>
  <li>This version changes the default behavior under 64 bit platforms such that the minimum allocation, alignment, and alignment offset is 16 instead of 8. There may be some code that's dependent on it being 8. For example, the EAIO package EAIOZoneObject class allocates memory with an alignment offset of 8 and fails under this new version. The EAIO package has been updated to handle this.</li>
  <li>This version changes the default behavior for the case where you construct with a specified amount of core memory. It is no longer rounded up to mnNewCoreSize but rather the value you specified is used as-is. This prevents surprises, such as if the user constructs with a core memory size of 64K but 16MB is allocated instead.</li>
</ul>
<p>Changes</p>
<ul>
  <li>Added full 64 bit support to GeneralAllocator and NonLocalAllocator. For 64 bit platforms the following is now default:
    <ul>
      <li>Core memory can be &gt; 4GB per core block.</li>
      <li>Individual allocations can be &gt; 4 GB. </li>
      <li>Minimum alignment is 16 bytes.</li>
    </ul>
  </li>
  <li>Added the ability for the user to extend core memory via a callback CoreExtendFunction. Along with this is a new AddCoreEx public function.</li>
  <li>The allocating and freeing of core memory has been cleaned up and made more robust by way of defining a CoreType enum which describes core memory and allows for reliably knowing how to free it and extend it. Previously there was little flexibility in this regard and the requirements were hard understand.</li>
  <li>Added kHookTypeCoreExtended, which allows you to hook the extension of core memory, whether done internally or via a callback to the new CoreExtend function.</li>
  <li>Unix and Apple platforms now support kOptionExecutableCore. When this flag is enabled, automatically allocated core memory is executable.The option is ignored on platforms that don't support allocating executable memory. If this flag is enabled and executable memory is supported but fails, the core allocation fails and the user core allocation fallback is called. </li>
  <li>Expanded support under Microsoft platforms to use VirtualAlloc on OSs other than Windows and XBox 360 when available. </li>
  <li>Made it so that when you construct or Init GeneralAllocator with a specific requested core memory size, it is not rounded up to mnNewCoreSize (typically 16 MB), but rather is rounded up only to the minimum necessary (typically page size of 4096 bytes). </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.18.01</span> (May 7, 2012)</p>
<p>Additions</p>
<ul>
  <li>Added assertions to GeneralAllocator to verify that the max core size is not being exceeded.</li>
  <li>Added an option to GeneralAllocator to specify the size_type used. Previously it was hard-coded to uint32_t. </li>
</ul>
<p>Changes</p>
<ul>
  <li>Reduced NonLocalAllocator's min alloc and alignment sizes down to 1. There was no specific reason it needed to be 16 as before. Added the <span class="small">PPM_NLA_MIN_ALLOC_SIZE</span> config define which lets you set the min size to a custom value. <span class="small">PPM_NLA_MIN_ALIGN</span> already existed.</li>
  <li>Reduced NonLocalAllocator's max alloc size to (size_type max / 2), which means 2GB per allocation with a 32 bit size_type and UINT64_MAX with a 64 GB size_type. Previously it was double that. This came about to the change that reduced the min size to 1. </li>
  <li>Improved the assertions for NonLocalAllocator in the case that the user attempts to alloc &gt;= max alloc size.</li>
  <li><span class="small">PPM_CT_ASSERT</span> now uses C++ static_assert when available, though EABase. </li>
  <li>Updated documentation for realloc to fix a misstatement. </li>
  <li>Updated code to resolve some defects reported by Coverity. In no case were these reports indicative of an actual runtime bug, but the changes done are useful anyway.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed a possible assertion failure for the case <span class="small">PPM_MALLOC_AS_MMAPALLOC</span> == 1 and doing a memory-mapped alloc request over.</li>
  <li>Fixed a bug introduced in v1.17.01 which prevented building on <span class="small">EA_PLATFORM_PS3_SPU</span>. Submitted by Andreas Andersson.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.18.00</span> (March 6, 2012)</p>
<p>Additions</p>
<ul>
  <li>Added PSVita platform support (<span class="small">EA_PLATFORM_PSP2</span>).</li>
  <li>Added Airplay/Marmalade and CTR platform debug output support.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed XBox 360 warning related to InitializeCriticalSectionAndSpinCount returning void instead of a count like Windows does. </li>
  <li>Fixed bug in TrimCore whereby FreeCore returning false would result in the core not being returned to the heap correctly. Tentatively verified by Tim Smith.</li>
  <li>Removed support for sbrk on Unix when allocating additional core memory blocks. mmap is now used exclusively. Made sure that FreeCore frees memory blocks that were allocated using mmap. Previously there was a problem where if sbrk failed then a backup call to mmap succeeded, on shutdown the free didn't realize it should be freeing with munmap. There is still a to-do for this to formalize the naming and execution of alternative core allocation mechanisms.</li>
</ul>
Changes
<ul>
  <li>
    <p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">EASmallBlockAllocator - Added assert to tell the user when they try to use a min alignment/pool increment size &lt; sizeof(ptr) as this is an error condition. This is useful for 64 bit platforms.</p>
  </li>
  <li>Did some unit test changes for iOS to allow easier automated unit testing.</li>
  <li>Implemented explicit support for the rename of the Airplay platform to Marmalade. This is a mobile middleware platform which used to be called Airplay but that name conflicted with some Apple technology, so they changed the name to something equally senseless.</li>
  <li>Added code to EAGeneralAllocatorDebugWin32.cpp to prevent users from accidentally compiling it into a Win64 build and wondering why it doesn't work. You need to use EAGeneralAllocatorDebugWin64.cpp for Win64.</li>
  <li>Moved the variable declaration for GeneralAllocator AtomicUint       mEventId to be naturally 64 bit aligned. This may help with handling of the clang compiler on iOS, which fails to align 64 bit values on 64 bit boundaries. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.17.04</span> (January 11, 2012)</p>
<p>Changes</p>
<ul>
  <li>This version explicitly supports the Freebox platform.</li>
  <li>Removed unnecessary mutex lock in GeneralAllocator::GetBlockSize. Submitted by Avery Lee. </li>
  <li>Fixed a couple GCC warnings related to &quot;variable 'pPrevChunk' set but not used [-Werror=unused-but-set-variable]&quot; that you might see if using some recent versions of GCC. </li>
  <li>Added playbook-x86 build target support. </li>
  <li>Added GeneralAllocator option kOptionExecutableCore. When enabled this attempts to allocate new core memory that has executable permissions. For the most robust handling of this it's best if the user takes over core memory management instead of using kOptionExecutable core to get the default mechanism to do it. </li>
  <li>Worked around some warnings that the VC++ /analyze option generates. </li>
  <li>Changed filename case of some Windows headers to match the case of the files in the Windows SDK. This doesn't fix any bugs but does allow our case sensitivity checking tools to generate clean output. </li>
  <li>Fixed a unit test warning related to unmatched warning pop pragma on XBox 360.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.17.03</span> (November 21, 2011)</p>
<p>Additions</p>
<ul>
  <li>Added GeneralAllocator::kOptionLockDuringHookCalls, which causes the GeneralAllocator mutex lock to stay locked during calls to user hooks. If you can guarantee that your code won't cause deadlocks then this will allow GeneralAllocator to run a little faster and causes hook calls to never appear out of order to the user. Along with this is a eventId which is incremented for every Malloc, Free, Calloc, Realloc, etc. call and passed to the user in the hook call. This provides another means for the user to deal with potentially re-ordered hook calls for the case that the GeneralAllocator mutex isn't locked during hook calls.</li>
  <li>Added SmallBlockAllocator diagnostics functionality. Submitted by the Tiburon studio. </li>
</ul>
Bug Fixes
<ul>
  <li>Fixed a memory leak in StackAllocator. Submitted by Paul Terry.</li>
</ul>
Changes
<ul>
  <li>Updated AllocationRecorder to allow the user to supply an alternative to fopen/flclose etc file system functions. Fixed a bug while at it where the previous code was potentially calling fclose twice.</li>
  <li>Removed an assertion in SmallBlockAllocator::Pool::AllocateCoreBlock for the case of the return value being NULL. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.17.02</span> (August 18, 2011)</p>
<p>Additions</p>
<ul>
  <li>Added FreeUnusedCore to FixedAllocator. Implemented by Brian Hixon. </li>
  <li>Added CTR support. </li>
</ul>
Bug Fixes
<ul>
  <li>Fixed non-bulk build compile failure on iOS (e.g. iPhone). Reported by James Brookes. </li>
  <li>Fixed a rare bug where on some platforms (usually Unix) there could mistakenly be a chunk that's flagged as memory mapped which isn't. </li>
  <li>Fixed a bug which could cause a crash in rare cases where a memory request just about bumped up against the core block size. </li>
  <li>Fixed a potential bogus assertion failure in CheckRemallocedChunk. Reported by Bob Flanagan. </li>
</ul>
Changes
<ul>
  <li>Implemented a fix for a scalability problem for the case that huge numbers of free memory chunks collected in the same free list (&quot;large bin&quot;). This change was non-trivial and won't be considered stable until it gets more testing beyond the unit tests. Also it necessarily adds 1K of memory usage to the size of a GeneralAllocator instance. However, this feature comes at the cost of 1K of additional memory usage by a GeneralAllocator instance and a small performance drop due to the maintenance of additional data structures. The <span class="small">PPM_FREE_LIST_SCALABILITY_ENABLED</span> config option can be used to disable this functionality. </li>
  <li>Made it so that GeneralAllocator::AddCore lets users add core of a size smaller than the page size. Previously its rounding down of core sizes to nearest page size caused it to round small sizes down to zero. Requested by Alexandru Ene.</li>
  <li>VirtualAlloc calls under Microsoft platforms now try to allocate executable memory in addition to being read/write.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.17.01</span> (May 4, 2011)</p>
<p>Additions</p>
<ul>
  <li>Added Playbook support</li>
  <li>Added codestripper support</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed a bug where pushing a bookmark twice and then popping the bookmark in the stack allocator could cause the next bookmark's memory to be freed. </li>
  <li>Fixed a multithreading problem that could occur in MallocInternal, related to calling CallMallocFailureFunction. Reported by Ryan Butterfoss. </li>
</ul>
Changes
<ul>
  <li>Updated unit tests to use __android_log_write on the Android platform. Android doesn't support C printf as a debug output destination. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.17.00</span> (December 14, 2010)</p>
<p>Additions</p>
<ul>
  <li>Added an IsConstructed function to tell if an instance has constructed. This function works only in the case that the GeneralAllocator memory is known to be zeroed before construction, as with a global variable.</li>
  <li>Added StackAllocator::ValidateAddress and ValidateHeap functions. </li>
  <li>Added the <span class="small">PPM_FASTBINS_ENABLED</span> option to config.h. </li>
</ul>
Bug Fixes
<ul>
  <li>Fixed a bug with the 'GetCallStack' method on Xenon, where it could read past the end of the input buffer. </li>
  <li>Fixed bug in GeneralAllocator::GetLargestFreeBlock where it could report the wrong answer. Reported by Aleksander Trajkov.</li>
  <li>Fixed assertion in NonLocalAllocator::AddNodeToFreeList where an assertion could mistakenly trigger if you have <span class="small">PPM_NLA_DEBUG_DATA_SUPPORTED</span> defined to 0. Reported by Andy Younger. </li>
  <li>Fixed a couple related bugs in AddCoreInternal and ExtendCoreInternal which would result in heap corruption. Thanks to 


Henrik Karlsson from <span class="small">DICE</span> for solving this while I was away on loan to another project.</li>
  <li>Fixed a bug in StackAllocator where in rare cases PopBookmark could result in a corrupted bookmark stack. </li>
  <li>Fixed a bug in StackAllocator where compilation would fail if <span class="small">PPM_INCREMENTAL_OBJECTS_ENABLED</span> was 0. However, it defaults to 1 and nobody has set it to 0. Probably the option should be removed altogether and the code made cleaner due to removal of #ifdefs related to it. </li>
  <li>Fixed a multithreading bug in the usage of GeneralAllocatorDebug where an assert could be triggered and invalid debug information applied to blocks. </li>
</ul>
Changes
<ul>
    <li>Added a print <span class="small">EXIT</span>(n) at the end of the unit tests on wii to support EARunner_Wii; it will indicate to the runner that the test is completed. </li>
    <li>Reduced the memory size for some of the tests on wii because they were exhausting the malloc heap.</li>
    <li>TraceFunctionDefault now supports Android's __android_log_print, as Android doesn't support debug printing with printf. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.16.01</span> (June 01, 2010)</p>
<p>Release notes </p>
<ul>
  <li>This version provides updates for mobile platforms and for the CodeWarrior (1.3) and PS3 SN (330) compilers.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.16.00</span> (May 27, 2010)</p>
<p>Release notes </p>
<ul>
  <li>Added mobile phone support: Palm Pre,  Samsung bada, and Google Android. More mobile platforms to eventually follow. </li>
  <li>Moved the following to the extras directory: EAGeneralAllocatorSTL.h, EASystemAllocator.h. These are old files which aren't used any more by any identified users. EAHandleAllocator.h/cpp will got there soon too, once some depending code goes away. </li>
  <li>Removed some GCC 4.4 Linux warnings related to strict aliasing. </li>
  <li>Fixed mutex buffer size for iPhone and related platforms.</li>
  <li>Fixed a bug (introduced in 1.15.01) in the build file config option system. Reported by Sean Halliday. </li>
  <li>Removed some of the platform-specific PPMalloc/source directories and made them use the generic PPMalloc/source/glibc directory.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.15.05</span> (January 14, 2010)</p>
<ul>
  <li>Removed EANewDelete.cpp.</li>
  <li>Moved all configuration parameters to a single header: PPMalloc/internal/config.h. These parameters are all user-overridable via a header file or via nant build properties.</li>
  <li>Added a <span class="small">PPMALLOC_USER_CONFIG_HEADER</span> option to PPMalloc/internal/config.h so the user can #define a header file for PPMalloc to always compile before anything else. Suggested by Bob Summerwill. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.15.04</span> (December 10, 2009)</p>
<ul>
  <li>Updated EAGeneralAllocatorDebugWin64.cpp to deal with new Windows SDK versions which now define stack functionality themselves. </li>
  <li>Fixed an iPhone compiler warning regarding a printf %x format specifier. Reported by Cliff Hammerschmidt.</li>
  <li>Implemented workaround for a bug in the <span class="small">ARM</span> compiler which caused it to crash while compiling a macro.</li>
  <li>Updated nant .build file to allow overriding of most config parameters. Previously only the main ones were available for overriding. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.15.03</span> (November 18, 2009)</p>
<p>Additions </p>
<ul>
  <li>&lt;none&gt;</li>
</ul>
Bug Fixes
<ul>
  <li>Added compile fix for an unusual build configuration. Reported by Darryl Gates.</li>
  <li>Removed a couple compiler warnings that result from using --diag_error=68 (a non-default warning option) with <span class="small">SNC</span>. Reported by Jeff Skelton. </li>
</ul>
Changes
<ul>
  <li>Adjusted the code to avoid some 'remark' output from <span class="small">SNC</span> when compiling with <span class="small">SNC's</span> -Xdiag=2 option.</li>
  <li>The package now builds under <span class="small">SNC</span> for <span class="small">PS3</span> with the -Xfastmath=1 options. In practice these probably won't make much difference for this package. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.15.02</span> (October 5, 2009)</p>
<p>Additions </p>
<ul>
  <li>Added full support for Linux/Linux64 callstack reading in EAGeneralAllocatorDebugLinuxX86.cpp.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed some Linux64 / GCC 4.3 compiler warnings.</li>
  <li>Fixed a new PS3 SNC 300 compiler warning. </li>
</ul>
Changes
<ul>
  <li>Added Lock usage to ReportHeap and ReportBegin/ReportEnd so they no longer require the user to manually implement thread safety. Suggested by Brandon Cauthers.</li>
  <li>Modified <span class="small">EA_XBDM_ENABLED</span> slightly. Now it keys off of being equal to 0 or 1 instead of being undefined or defined. A result of this is that you may need to globally define <span class="small">EA_XBDM_ENABLED</span> to 1 in a release build if you want it to work there. For Framework2/Nant users, the PPMalloc.build file supports using <span class="small">EA_XBDM_ENABLED</span>=[0|1] in the masterconfig.xml file. Suggested by Kevin Perry. </li>
  <li>Modified PPMalloc.build to disable warnings as errors for end users. This is to allow builds to be less broken by compiler warning changes such as that addressed above in the SNC 300 bug fix. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.15.01</span> (August 11, 2009)</p>
<p>Additions </p>
<ul>
  <li>Added examples/MinimalAlignmentAllocator.h/cpp. Provided by David Cope. Removed two other files from the examples directory, as they are no longer relevant. </li>
  <li>PPMalloc: Added GeneralAllocator kOptionCoreTopDown option.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed compiler warning in SmallObjectAllocator::GrowPool for the case of <span class="small">PPM_DEBUG</span> &gt;= 2.</li>
  <li>Fixed memory overwrite bug in Win64 GetCallstack under VS2005. This occurred due to incorrect Microsoft documentation regarding the RtlVirtualUnwind function. Found by Tom Van Dijck and Albert Ho.</li>
  <li>Fixed bug whereby GeneralAllocator::mbUnsortedBinEnabled was not initialized in the constructor. This could result in the allocator having slightly different performance characteristics and different block placement, though it wouldn't result in crashes or other fatal behavior. Reported by Ralf Kornmann. </li>
  <li>Fixed potential bogus assertion in GeneralAllocatorDebug::SetDebugInfoForAllocation. </li>
  <li>Fixed Win64 bug in SmallBlockAllocator which could cause a crash in Free, and a nearly identical bug in SmallObjectAllocator which could cause a crash in GetAllocationInfo. These crashes could occur if the alllocators are using core memory which is at addresses beyond 2^32, as the bug was due to casting an address to uint32_t, which isn't 64 bit safe. </li>
</ul>
Changes
<ul>
  <li>Revised the .build file to expose all significant config defines as user-controllable global properties. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.15.00</span> (April 6, 2009)</p>
<p>Additions </p>
<ul>
  <li>Added SmallObjectAllocator::kOptionAlwaysFreeCoreBlocks, which more aggressively frees unused pool memory. It is disabled by default for backward compatible heap behavior.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed bug in ReportHeap whereby only the first core block would be reported if you have multiple core blocks and your block type flags included only kBlockTypeCore.</li>
  <li>Fixed bug in SmallObjectAllocator.h whereby it was missing header include guards. Reported by 


Dominic Mathieu.</li>
  <li>Fixed bug in SmallObjectAllocator.cpp whereby it would give a compile error if <span class="small">PPM_NULL_POINTER_FREE_ENABLED</span> was disabled. Reported by 


Dominic Mathieu.</li>
  <li>Fixed bug in Win64 callstack functionality that could have caused a crash. This bug is noted in the release notes for PPMalloc 1.14.04. Found by Tom Van Dijck.</li>
  <li>Fixed some compiler warnings related to strict aliasing with GCC/PS3.</li>
</ul>
Changes
<ul>
  <li>Revised the default debug fill values for 360 and PS3 to be improved. The new values are more likely to trigger an exception (as opposed to silent bad behavior) if used as a pointer than the previous values. See PPMalloc/include/internal/shared.h for the definitions.</li>
  <li>Made the GetUsableSize function (present in many of the heap classes) have consistent documented behaviour regarding a NULL input pointer. It now always returns -1 for all PPMalloc heap classes.</li>
  <li>Disabled assertion in EASmallObjectAllocator::MallocAligned. It seemed to be triggering, though it's normally not supposed to.</li>
  <li>Disabled assertion in GeneralAllocatorDebug::SetDebugInfoForAllocation regarding (nDifference &lt; 32768).</li>
  <li>SmallBlockAllocator::Pool::ReportEnd and SmallObjectAllocator::ReportEnd now always clear the ReportContext, even in non-debug.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.14.04</span> (December 9, 2008)</p>
<p>Release Notes</p>
<ul>
  <li>One user has reported that the Win64 callstack functionality crashes in a debug-release build, but not others, and has done so since it was first introduced. This crash hasn't yet been identified or fixed, but it doesn't seem to occur for most users. (Update: Fixed in 1.14.05) </li>
</ul>
<p>Additions </p>
<ul>
  <li>Added kOptionMMapPageSize, which allows you to tell 360 and PS3 builds to use large virtual page sizes. You can use a size of 65536 or greater on 360 or a size of 1048576 on PS3 to trigger usage or larger page sizes (64 KiB and 1 MiB respectively).</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed bug in GeneralAllocator::ValidateAddress for mapped memory (Windows/Unix) whereby it would not validate the list chunks (pMMapChunk) that it intends. Reported by Hitesh Shah. </li>
  <li>Fixed bogus assert in SmallBlockAllocator::Init. Reported by Daniel Craig. </li>
  <li>Fixed Win32/Win64 bug in GeneralAllocator::ExtendCoreInternal where the extension size was not a multiple of 65536. Reported by 


Andrew Farrier.</li>
  <li>Fixed missing call to mHashTable.Clear() in NonLocalAllocator::Shutdown(). The result was that reusing a NonLocalAllocator would result in redundant hash table entries (the hash table is a list of valid allocator pointers in debug builds). Reported by Brandon Ehle. </li>
</ul>
Changes
<ul>
  <li>&lt;none&gt;</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.14.03 </span> (September 1, 2008)</p>
<p>Additions </p>
<ul>
  <li>Added VS2008 support. This affected only the Win64 build; the Win32 build required no modifications. </li>
</ul>
Bug Fixes
<ul>
  <li>Fixed pc64 code callstack code generation problem in optimized builds by disabling compiler optimization around a problem function. </li>
  <li>Fixed bogus assertions in SmallObjectAllocator::Malloc, Free, ValidateHeap, and GrowPool. Reported by Michael Schwartz.</li>
  <li>Fixed <span class="small">PPM_DEBUG</span> = 3 compile failure in SmallObjectAllocator. Reported by Luc Isaak. </li>
  <li>Fixed crash bug in GeneralAllocator::MallocInternal when memory is exhausted with thread safety  disabled. Reported by Eric Tolman. </li>
  <li>Fixed Unix bug in GeneralAllocator::AddCoreInternal which was introduced in PPMalloc 1.01.00 (a.k.a. 1.1.0). Reported by Christopher White. </li>
</ul>
Changes
<ul>
  <li>Updated PS3 version of GetCallStack (copied from the EACallstack package) to support more than just one callstack entry and to support SPU. </li>
  <li>Updated Win32 version of GetCallStack to use DuplicateHandle. Apparently sometimes the Microsoft DbgHelp library doesn't like the GetCurrentProcess pseudo-handle. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.14.02</span> (June 10, 2008)</p>
<p>Additions </p>
<ul>
  <li>&lt;none&gt;</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed crash bug in GeneralAllocator::MallocAligned when kAllocationFlagBestFit, kAllocationFlagEndFit, and kAllocationFlagAlwaysAlign were used together. These are new flags which aren't likely yet being used by many. Found by by Michael Schwartz.</li>
  <li>Fixed assertion failure in SmallObjectAllocator. This isn't likely to have been resulting in any ill behavior.</li>
  <li>Fixed pc64 (Win64) callstack function return value whereby it could return a value greater than intended. This could have crashed if you gave it a small stack space to work with. </li>
  <li>Fixed pc64 (Win64) SmallBlockAllocator core block alignment bug. This isn't likely to have been resulting in any ill behavior.</li>
  <li>Fixed pc64 (Win64) potential SmallBlockAllocator MallocAligned failure when it could have found an aligned block. </li>
</ul>
Changes
<ul>
  <li>Disabled pc64 (Win64) compiler optimization for the GeneralAllocatorDebug::GetDebugInfoForAllocation function, due to code misgeneration under some configs. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.14.01</span> (May 19, 2008)</p>
<p>Release Notes</p>
<ul>
  <li>SmallObjectAllocator now enforces the setting of the core memory allocator before calling Init, whereas previously it required this but didn't enforce it. This change may break code, though it break will always be immediately detected and is trivial to fix: simply put the SetCoreAllocationFunction call before the Init call. </li>
</ul>
<p>Additions </p>
<ul>
  <li>&lt;none&gt;</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed NonLocalAllocator free core callback misreported size. Reported by Henrik Karlsson.</li>
  <li>Changed PS3 minimum core size from 65536 back down down 4096. It was changed to 65536 in v1.14.00 but didn't need to be so. </li>
</ul>
Changes
<ul>
  <li>SmallObjectAllocator now allows for a user-determined max pool size instead of a hard-coded predefined version. Implemented by Philip Kavan. </li>
  <li>As noted in the releast notes above, SmallObjectAllocator now enforces the setting of the core memory allocator before calling Init, whereas previously it required this but didn't enforce it. This change may break code, though it break will always be immediately detected and is trivial to fix: simply put the SetCoreAllocationFunction call before the Init call.</li>
  <li>Added FAQ entry related to XBox 360 crash dumps omitting physical memory. Prompted by Chris Jacobson.</li>
  <li>Improved the GeneralAllocator::ValidateHeap function to catch a small block overrun which it didn't catch previously. Prompted by an observation by Michael Schwartz.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.14.00 </span> (April 11, 2008)</p>
<p>Additions </p>
<ul>
  <li>Added GeneralAllocator::kOptionEnableUnsortedBin. Prompted by observations by Ralf Kornmann.</li>
  <li>Added StackAllocator::GetTopBookmark. </li>
  <li>Added NonLocalAllocator::TrimCore, which frees up unused core memory. It is similar to GeneralAllocator::TrimCore. </li>
  <li>Added PS3 mapped memory option to GeneralAllocator to match Windows and XBox 360. As with other platforms, you can explicitly request mapped memory via kAllocationFlagMMap and you can get mapped memory via Malloc if your request is greater than kOptionMMapThreshold and no other free memory is available. You can disable mapped memory on startup by setting kOptionMMapMaxAllowed to zero. Suggested by Henrik Karlsson.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed bookmark memory leak in StackAllocator. Reported by Chris Corliss.</li>
  <li>Removed usage of __out and __in for Win32 build for better portability across Windows versions. Reported by Andrew Willmott. </li>
  <li>Fixed bogus validation failure in GeneralAllocatorDebug introduced in v1.12.00. Some additional debug validation was added in 1.12.00 but it mistakenly indicated that a certain kind of internal block was bad when it was fine. </li>
  <li>Fixed bug in NonLocalAllocator::MallocAligned whereby an allocation request of a size that exactly matches the entire heap size would fail unless the user specified kAllocationFlagBestFit. Reported by Brandon Ehle. </li>
  <li>Fixed memory leak in NonLocalAllocator whereby a single 32 byte node per core block might be leaked. There is usually only one core block, though there can be a few if the user chooses to setup NonLocalAllocator to do so. </li>
  <li>Fixed potential false positive return value of GeneralAllocatorDebug::ValidateAddress for the case whereby the queried memory was actually in a delayed free list. This has been on the to-do list for a number of months, though the bug is unlikely to have affected anybody. </li>
</ul>
Changes
<ul>
  <li>StackAllocator::PushBookmark now returns bool instead of void. </li>
  <li>NonLocalAllocator debug memory usage improved for the case whereby there isn't debug info. Suggested by Simon Everett. </li>
  <li>NonLocalAllocator now frees any memory leaks for the user on Shutdown.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.13.02</span> (February 16, 2008)</p>
<p>Additions </p>
<ul>
  <li>Added built-in callstack support to pc64 configuration.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed some PS2 compilation errors that were introduced with v1.13.00. Thanks to Philip Dunstan and James Fairweather   for the reporting and fixing.</li>
  <li>PS2 callstack functionality has been restored. It was unintentionally disabled starting with v1.11.00. </li>
  <li>Fixed bug in Examples/EAStompAllocator.cpp/MallocAlignedDebug() whereby it would miscalculate aligned_size. Submitted by 


Michael Schwartz.</li>
</ul>
Changes
<ul>
  <li>Changed GeneralAllocator::AddCore error return string from 'invalid core' to 'exhausted memory'. Suggested by Avery Lee. </li>
  <li>Added printf(&quot;\32&quot;) to end of unit test under PS3 and PS2. This indicates to the SN tools that the app is done.</li>
  <li>Bogus unit test failure report on PS3, Wii fixed. </li>
  <li>Win32 and Win64 unit tests now support DLL mode.</li>
  <li>Revised the unit tests to take less time to run. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.13.01 </span> (December 21, 2007)</p>
<p>Additions </p>
<ul>
  <li>Added support for the SN PS3 compiler.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed compiler warning generated by GCC 4.1.x and PS3 SDK 210+. </li>
</ul>
Changes
<ul>
  <li>SmallBlockAllocator documentation updated. Submitted by Henry Allen. </li>
  <li>SmallBlockAllocator natively supported by the build file and associated initialize.xml file. Submitted by Henry Allen. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.13.00 </span> (November 8, 2007)</p>
<p>Release Notes</p>
<ul>
    <li>An alternative SmallBlockAllocator written by Henry Allen of Tiburon has 
    been added to the extras directory. This allocator is called Small<i>Block</i>Allocator 
    as opposed to the SmallObjectAllocator present in the PPMalloc source 
    directories and can be used in parallel with SmallObjectAllocator for 
    comparison purposes. This is a candidate replacement or permanent 
    alternative to the existing SmallObjectAllocator. See the
    <a href="SmallBlockAllocator.html">SmallBlockAllocator.html</a> 
    documentation for a description of it. Any comments on this are welcome and 
    can be posted to the UTF Users mailing list or possibly directly to the 
    maintainers of PPMalloc.</li>
</ul>
<p>Additions </p>
<ul>
  <li>Added Python script to <em>examples</em> directory which converts Juice recordings to PPMalloc EAAllocationRecorder recordings.</li>
  <li>Implemented support for aligned memory with (kAllocationFlagPerm | kAllocationFlagBestFit). This was prompted by the Medal of Honor Airborne for PS3 project, but is useful in general.</li>
  <li>Added FAQ entry on how to replace malloc/free (as opposed to new/delete) on PS3/GCC. </li>
  <li>Added kOptionFailureValue to NonLocalAllocator. It lets you specify the malloc failure return value, which defaults to being NULL. </li>
    <li>Added GeneralAllocatorEphemeral.cpp to the extras directory. This is 
    shows how to implement a trick called &quot;ephemeral allocation.&quot;</li>
    <li>Added SmallBlockAllocator to the extras directory as potential new 
    module for users to try out. </li>
</ul>
Bug Fixes
<ul>
  <li>Fixed bogus assert in GeneralAllocator::CheckChunk for case when user defines <span class="small">PPM_DEBUG_PRESERVE_PRIOR</span> to zero. Submitted by Phillip Kavan. </li>
  <li>Fixed bogus assert in SmallObjectAllocator::GrowPool. Submitted by Phillip Kavan.</li>
  <li>Fixed bogus validation failure in GeneralAllocator::ValidateAddress for memory mapped allocations (on platforms/configurations that support such allocations, as with Windows). Submitted by Hitesh Shah.</li>
  <li>Fixed compile failure in NonLocalAllocator and SmallObjectAllocator for <span class="small">PPM_DEBUG</span> &gt;= 2.</li>
  <li>Fixed 64 bit platform bug in SmallObjectAllocator whereby it was expecting 
    an offset to be 64 bit aligned but it was only 32 bit aligned, resulting in 
    an assertion failure. It is not immediately clear if this would result in 
    incorrect runtime behavior. Discovered by the unit tests.</li>
    <li>Fixed compile failure in EAAllocationRecorder for the case of 
    multithreading being disabled. Reported by Simon Golding.</li>
    <li>Fixed declaration of InitializeCriticalSectionAndSpinCount for the case 
    of building with VC7 or earlier and not using Framework2/eaconfig. 
    InitializeCriticalSectionAndSpinCount is only enabled by &lt;windows.h&gt; if 
    <span class="small">_WIN32_WINNT</span> &gt;= 0x0403, yet it is present in all significant versions of the 
    Windows kernel. Reported by Jeff Dixon.</li>
</ul>
Changes
<ul>
  <li>The unit tests have been augmented to catch more compile problems due to unusual build/option configurations. Nearly all the bugs that are fixed in this release and the previous (1.12.01) release were due to the package being built in some way or with some configuration that isn't default. So additional unit tests which exercise configuration options have been created to help identify this in the future. The PPMalloc package has a number of configuration #defines (e.g. PPM_MIN_ALIGN) which tweak the way it works, but these create testing and maintentance problems. </li>
  <li>EAAllocationRecorder has been augmented. The Playback function now lets you play a single line specified by char*, the unit tests have been mildly augmented, the documentation has been improved. This change modifies the interface of EAAllocationRecorder, though it could affect only tools and testing applications and not runtime usage.</li>
    <li>Deprecated kOptionEnableHighAllocation; it is now considered always 
    enabled. This is a step in the effort to simplify GeneralAllocator. 
    Similarly, PPM_HIGH_SUPPORTED is also no longer recognized.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.12.01 </span> (September 6, 2007)</p>
<p>Additions </p>
<ul>
  <li>Added unit test called TestDisableSystemAlloc.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed linker error introduced recently in v1.11.03 regarding PPMMutexLock/PPMMutexUnlock. Found by Phillip Kavan 
  and Brian Hixon.</li>
  <li>Fixed compile error in EAAlloctorInterface.cpp regarding kDefaultFillValueFree that was created in the a recent version (1.11.03). Found by Martin Griffiths.</li>
  <li>Fixed usage of &copy; to (c) in the version.h file so that the code can be compiled under any locale. </li>
  <li>Fixed bug in GeneralAllocator::CheckState whereby it could mistakenly return that the check failed when in fact it was OK. Submitted by Phillip Kavan.</li>
  <li>Fixed bogus assertion failure in EAStackAllocator.cpp</li>
</ul>
Changes
<ul>
  <li>Removed support for misspelled SetHookFuncton (the correct spelling is of course SetHookFunction).</li>
  <li>AddCore(0, someSize) now unilaterally commits all of someSize on platforms that support the concept of reserved vs. committed memory (e.g. Win32). Previously this could result in unused reserved address space, a situation which the user probably doesn't want. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.12.00 </span> (July 23, 2007)</p>
<p>Release Notes</p>
<ul>
  <li>ReportHeap now supports kBlockTypeCore as described below. This may affect user code that was using ReportHeap but was ignoring the block type flag. </li>
</ul>
<p>Additions </p>
<ul>
  <li>ReportHeap (and friends) now supports kBlockTypeCore. Arguably, the addition of this functionality constitutes a bug fix, as the ReportHeap API has always implied that kBlockTypeCore would be supported. </li>
  <li>Added GeneralAllocator::ValidateChunk() which allows per-Chunk debug validation.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed bug on Windows whereby core memory is not freed during shutdown when freed by the internal VirtualFree. Bug found by Alexis Kwong.</li>
  <li>NonLocalAllocator fix for metrics gathering, submitted by Johan Andersson.</li>
  <li>Fixed InitializeCriticalSectionAndSpinCount usage on XBox (original XBox, not XBox 360).</li>
  <li>Fixed bug in Win32 version of DescribeCallStack whereby very long symbol names could cause a buffer overrun. Bug found by Ralf Kornmann.</li>
</ul>
Changes
<ul>
  <li>Changed the guard fill failure reporting to give the user more information. Suggested provided by Avery Lee. </li>
  <li>Updated the page protected allocator to be a formally implemented .h/cpp file pair and a class called StompAlocator. This version merges in the latest stompallocator supplied by Kevin Perry. </li>
  <li>Win32 and Win64 builds use the <span class="small">MEM_WRITE_WATCH</span> flag in VirtualAlloc in debug builds. This will allow for much faster heap validation. The PPMalloc unit test now has an initial test function for doing such a fast heap validation, and this will likely find its way into GeneralAllocator::ValidateHeap soon. This was based on a suggestion by  Ralf Kornmann.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.11.03</span> (May 30, 2007) </p>
<p>Release Notes</p>
<ul>
  <li>This release introduces the first public beta versions of NonLocalAllocator and SmallObjectAllocator. These classes are fully functional, mostly optimized, and fairly well tested. However, there may exist bugs, limitations, or design flaws. Feel free to comment on these or try them out. <br>
    <br>
  Thanks for the suggestions provided by Aaron Rehaag, Andrew Brownsword, Brian Hixon, Alex Fry, Brent Thale, Chris Cummings, Daniel Craig, David Galeano, Frank Barchard, Icer Addis, James Fairweather, Mike Rayner, Nicholas Hendricks, Rob Povey, Scott Randolph, Stefan Boberg, and Stu McKenna.</li>
</ul>
<p>Additions </p>
<ul>
  <li>&lt;none&gt;</li>
</ul>
Bug Fixes
<ul>
  <li>&lt;none&gt;</li>
</ul>
Changes
<ul>
  <li>NonLocalAllocator and SmallObjectAllocator are now considered to be of beta testing status.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.11.02 </span> (May 16, 2007) </p>
<p>Additions </p>
<ul>
  <li>&lt;none&gt;</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed compile warnings in dll configurations related to NonLocalAllocator::HashTable.</li>
  <li>Fixed compile error that could occur when building a .sln file that was generated by nanttovstools. This was due to a typographical error in PPMalloc.build. </li>
  <li>Fixed unit tests to support compiling under VC++ when the -GX compiler option is enabled. Previously eaconfig cross builds of the unit tests would fail due to this. </li>
</ul>
Changes
<ul>
  <li>Changed the PS3 mutex code to use sys_lwmutex instead of sys_mutex. The former is significantly faster in the case of non-waiting locks.</li>
  <li>Revised the file organization to accomodate the addition of NonLocalAllocator. This entailed moving functionality that is shared between GeneralAllocator and NonLocalAllocator to shared source files such as shared.h/cpp and mutex.h/cpp/inl.</li>
  <li>Revised .build file to enable -Wp64 under VC++/Win32.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.11.01</span> (May 4, 2007) </p>
<p>Additions </p>
<ul>
  <li>Added initial header and source files for EANonLocalAllocator and EASmallObjectAllocator. These are not yet usable. </li>
</ul>
Bug Fixes
<ul>
  <li>Fixed mutex compiler error for non-Linux based Unix variants such as BSD and Cygwin.</li>
</ul>
Changes
<ul>
  <li>Removed version #defines from individual allocator headers. They were tedious to maintain and didn't turn out to be necessary. </li>
  <li>Overhauled the unit test system to make it easier to maintain and extend.</li>
  <li>Coalesced the build files into a single ppmalloc.build file.</li>
  <li>Removed version defines from header files. These weren't being used and increased maintenance work. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.11.00</span> (April 11, 2007) </p>
<p>Release Notes</p>
<ul>
  <li>This release does not include the two major features currently on deck: NonLocalAllocator and SmallObjectAllocator. These features will hopefully be in beta form in the next major package release after this one. </li>
</ul>
<p>Additions </p>
<ul>
  <li>Added Cygwin compatibility for both the runtime and the unit tests. </li>
  <li>Added a FAQ entry regarding ptmalloc.</li>
  <li>Added missing sndbs and IncrediBuild entries in masterconfig.xml so that distributed builds work. Had to add an extra warning suppression (probably VS2003 vs VS2005) and a dependency from the tests onto the runtime so the SLN workflow works. Bob Summerwill implemented this. </li>
  <li>Added a new unit test: TestDebugDataLocationSeparate.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed bug in StackAllocator (in the FreeObjectsEx function) whereby a bookmark placed at the top of the stack but which refers to a previous core block could become stale and later cause a crash because the memory for the bookmark itself would be gone. </li>
  <li>Fix for a couple compiler warnings under Linux/GCC3.4.</li>
  <li>Fixed CodeWarrior/Wii compiler warnings and bulk-build incompatibility. </li>
</ul>
Changes
<ul>
  <li>Revised the assertion failure mechanism to give the user significantly more information about the failure.</li>
  <li>InitializeCriticalSection usage changed to InitializeCriticalSectionAndSpinCount. Multiprocessing is becoming prevalent and users the introduction of a spin count has improved performance for EA games that have tried it in PPMalloc. So we make this available in the default distribution.</li>
  <li>Removed a couple assertions from StackAllocator; they didn't truly indicate usage violations. </li>
  <li>Implemented debug build memory filling optimization in ClearFastBins that results in more efficient debug memory filling. If you are seeing slow performance of ClearFastBins in debug builds then this should fix your problem. </li>
  <li>Switching PS3 asm &quot;trap&quot; usage to asm &quot;tw 31,1,1&quot;. That makes friendlier to debugging. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.10.00</span> (Feb 8, 2007) </p>
<p>Additions </p>
<ul>
  <li>Added DynamicSOA (Dynamic Small Object Allocator) to the examples directory. If such a thing becomes recognized as universally useful, it can perhaps be promoted to the main supported source modules. DynamicSOA was contributed by  Kosta Arvanitis.</li>
</ul>
Bug Fixes
<ul>
  <li>Fixed some Metrowerks compiler warnings under Nintendo DS.</li>
  <li>Robusitified the ValidateHeap function to better deal with corrupted heaps. If the heap is corrupted, it will much more likely assert and/or return false than it would crash.</li>
  <li>Fixed potential <span class="small">NULL</span>-pointer reference exceptions in calls to <span class="small">PPM_ASSERT</span>(this, PPMMutexGetLockCount(mpMutex) &gt; 0);</li>
  <li>Fixed bug in Malloc whereby if the user requested a block from high memory, but a block from low memory was in the fastbin cache, it would return the fastbin cache block. </li>
  <li>Fixed FixedAllocatorBase::Shutdown to set mpHeadChunk to <span class="small">NULL</span>. Without this you can't safely re-use a FixedAllocatorBase that has been Shutdown. </li>
</ul>
Changes
<ul>
  <li>StackAllocator no longer assumes that Malloc will always succeed. It now returns <span class="small">NULL</span> if there is no core memory nor can any new core memory be allocated.</li>
  <li>Added a slight optimization to StackAllocator to use <span class="small">EA_UNLIKELY</span> for some of the if statements. <span class="small">EA_UNLIKELY</span> is defined in EABase. </li>
  <li>On XBox 360 XPhysicalAlloc with fast 16MB pages is now used instead of malloc to do a default core alloc. This was contributed by Simon Golding, Nicholas Hendricks, and Barry Feather.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.09.02</span> (November 14, 2006) <br>
  <br>
  Release Notes</p>
<ul>
  <li>This version makes instances of gpEAGeneralAllocator and gpEAGeneralAllocatorDebug 
    whereas previous versions required the user to do so. As a result, any existing 
    user code that declares these variables will result in a duplicated symbol 
    linker error. This can be resolved by removing the user version of the variable 
    or by defining PPM_ENABLED = 0 in the PPMalloc build. See PPMalloc/source/setallocator.cpp 
    for where this occurs.</li>
</ul>
<p>Additions </p>
<ul>
  <li>This version adds a new configuration define called <span class="small">PPM_MIN_ALIGN</span>. This 
    sets the minimum alignment for allocated memory to be a value greater than 
    the usual value of 8. This option is not yet fully tested and isn't yet supported. 
    It is planned to be so in a future release.</li>
</ul>
Bug Fixes 
<ul>
  <li>&lt;none&gt;</li>
</ul>
Changes 
<ul>
  <li>Added support for VS2005 (VC8).</li>
  <li>Changed the default EABase in masterconfig.xml to be EABase 2.0.12 instead 
    of the previous 2.0.7.</li>
  <li>Made it so that the gpEAGeneralAllocator and gpEAGeneralAllocatorDebug variables 
    are declared by default.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.09.01</span> (November 9, 2006) </p>
<p>Release Notes</p>
<ul>
  <li>This version adds explicit support for Nintendo DS and adds bulk-build support for eaconfig. </li>
</ul>
<p>Additions </p>
<ul>
  <li>Added support for Nintendo DS to GeneralAllocator / GeneralAllocatorDebug. Thanks for Idries Hamadi for implementing this.</li>
  <li>FixedAllocator now has a Reset function. This function unilaterally clears the container and restores it to a newly initialized state.</li>
  <li>Added disabling of VC++ compiler warning C4748, which relates to the /GS compiler option in a release build. There are no existing cases of this warning in user's builds, and there won't likely ever be, as people generally don't use /GS with optimized builds.</li>
  <li>Added disabling of VC++ compiler warning C4740. </li>
  <li>Added &quot;bulk-build&quot; (a.k.a. &quot;unity build&quot;) support to the .build file. </li>
</ul>
Bug Fixes
<ul>
  <li>&lt;none&gt;</li>
</ul>
Changes
<ul>
  <li>Moved the change list from the root directory .txt file to this doc/Changes.html file. </li>
</ul>
<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;"></span>
<p><span style="font-weight: bold;">Version 1.09.00</span> (September 18, 2006)</p>
<p>Release Notes</p>
<ul>
  <li>Due to the bug fix regarding GetBlockInfoForChunk, heap reports which labelled internal blocks as kBlockTypeAllocated will now label then as originally intended: kBlockTypeInternal. User heap report code might be affected by this change.</li>
</ul>
<p>Additions </p>
<ul>
  <li>Added recognition of PPMALLOC_DLL in addition to EA_DLL in order to use PPMalloc as a DLL. EA_DLL is a global define that causes everything to be built and used as DLLs. However, the user may want to set just PPMalloc to be built and used as a DLL.</li>
  <li> GeneralAllocatorDebug's debug data reading function has been moved from its protected space to public space as GetDebugDataStatic / SetDebugDataStatic.</li>
</ul>
<p>Bug Fixes
</p>
<ul>
  <li>Fix bug in GeneralAllocatorDebug which misassigned the value for kDebugDataIdAllocator.</li>
  <li> Fixed bug in GeneralAllocator::GetBlockInfoForChunk whereby chunks returned to the user during a heap report would not be labelled as 'kBlockTypeInternal' when the block was internal. </li>
  <li> Fix for assert regarding page size that would occur on Xenon if you exhausted system memory.</li>
  <li> EAAllocationRecorder.h fixed to properly deal with the case whereby PPM_ENABLED = 0.</li>
  <li> FixedAllocator fixed to deal with the case whereby the user species an object count of just zero or one. User's don't do this in practice, but FixedAllocator would crash or corrupt memory if they did.</li>
  <li> Fix for ReportNext/GetBlockInfoForChunk to rectify case whereby blocks that were memory-mapped + aligned would have their reported pointer values be incorrect. A result of this was that TraceAllocatedMemory would think a pointer was bad when it wasn't and would generate a bogus assert.</li>
  <li> Fix for GeneralAllocator/GeneralAllocatorDebug not working with GCC strict pointer aliasing assumptions. Previously, you needed to compile with -fno-strict-aliasing in order for GeneralAllocator to compile correctly. This change fixes the known existing incompatibilities with strict pointer aliasing. However, more testing will need to be done to verify that all such pointer aliasing issues are resolved.</li>
</ul>Changes
<ul>
  <li> Modified GeneralAllocator::AssertionFailureFunctionDefault to force-break on more platforms.</li>
  <li> Converted some use of \t in the source code to four spaces; done for consistency.</li>
  <li> Split FixedAllocator&lt;&gt; into FixedAllocatorBase and FixedAllocator&lt;&gt;. FixedAllocatorBase is a generic non-templated base for FixedAllocator&lt;&gt;. FixedAllocator&lt;&gt; is now nothing but a simple pass-through template with just two inline functions (ctor and Init).</li>
  <li> Added a small item to GeneralAllocator::Shutdown(). When tracing allocated memory (i.e. leaks), it now prints the allocator name with the allocation trace.</li>
  <li> The Xenon callstack reading functionality now can work in a shipping release build; it no longer relies on xbdm functionality, which is not allowed in a shipping build.</li>
  <li> Modified GeneralAllocatorDebug::ValidateHeap so that it uses a local SnapshotImage struct to do its heap report instead if using heap memory to do it.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;"></span>
<p><span style="font-weight: bold;">Version 1.08.00</span> (April 10, 2006)</p>
<p>Additions </p>
<ul>
  <li>Added explicit support for the new Nintendo Revolution (<span class="small">EA_PLATFORM_REVOLUTION</span>)Added explicit support for the new Nintendo Revolution (<span class="small">EA_PLATFORM_REVOLUTION</span>). </li>
  <li>Added Win64 / x86-64 support, including a unit test project.</li>
</ul>
Bug Fixes
<ul>
  <li>Removed EA::Allocator:: explicit qualifier from EASystemAllocator. GCC 4.x seems to have a problem with it. </li>
</ul>
Changes
<ul>
  <li>Made all internal header references be relative to the header root instead of the header file doing the #include. Some compilers (e.g. Metrowerks) don't support implicit relative header includes.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;"></span>
<p><span style="font-weight: bold;">Version 1.07.00</span> (February 15, 2006)</p>
<p>Release Notes</p>
<ul>
  <li>Thanks to Henry Goffin for finding and fixing various bugs that were fixed in this version, particularly those relating to mapped memory.</li>
</ul>
<p>Additions </p>
<ul>
  <li>Added GeneralAllocator::SetInitCallback, which is a simple implementation of the popularly requested mechanism to allow users to detect the set of existing allocator instances. This mechanism is fairly lightweight.</li>
  <li> Added AsInterface, which is a complement to SetInitCallback and which allows the user to detect whether a given GeneralAllocator is a GeneralAllocator or its subclass GeneralAllocatorDebug. This is useful for automated tools that want to identify and use heaps dynamically. This mechanism is trivially lightweight.</li>
  <li> Added Get/SetName, which is a complement to SetInitCallback and which allows the user to identify an allocator by name. This is useful for automated reporting tools so that they can report on heaps by name. This mechanism is trivially lightweight.</li>
  <li> Added the following FAQ entries:
    <ul>
      <li>How do I debug heap corruption problems?</li>
      <li>Why use a heap manager on XBox 360, PS3 and PC when they have a hardware MMU?</li>
      <li>Is GeneralAllocator deterministic?</li>
      <li>How do I prevent users from calling global malloc and new?</li>
      <li>I am getting a linker error regarding gpEAGeneralAllocator.</li>
      <li>The Windows task manager is showing different memory stats than GeneralAllocatorDebug.</li>
    </ul>
  </li>
  <li> Added documentation to the ValidateHeap function in EAGeneralAllocator.h.</li>
  <li> Added mpCore to GeneralAllocator::BlockInfo, so now you can tell which core block an allocation came from while doing heap reports.</li>
  <li> Added GeneralAllocator::SnapshotImage struct definition, in order to assist the user in defining a scratch buffer for heap traces. The user is not forced into using SnapshotImage, as the user may have a better source of scratch memory.</li>
  <li> Added example usage documentation to various functions in GeneralAllocatorDebug.</li>
</ul>
<p>Bug Fixes
</p>
<ul>
  <li>Fixed a compiler warning under PS3 related to an unused variable.</li>
  <li> Fixed a bogus assert under PS3 related to expected 'chunk' size.</li>
  <li> Fixed a bogus assert under Win32 related to core resizing.</li>
  <li> GeneralAllocatorDebug::ValidateAddress bug fixes: In one case it could give a false negative when the pointer validation map is disabled. Also, it didn't check for the possibility of mapped memory. Both of these have been fixed.</li>
  <li> Fixed bug in GeneralAllocator::TakeSnapshot whereby when the user supplies a block of memory to use for the snapshot, the bytes before that memory might be stomped.</li>
  <li> Fixed documentation error in GeneralAllocatorDebug.h whereby it said that kDebugDataIdAllocationCount begins at zero, whereas in reality it begins at one.</li>
  <li> Fixed bug in GeneralAllocator::ReportNext whereby it was reporting internal chunks when the user didn't specify kBlockTypeInternal.</li>
  <li> Fixed bug in GeneralAllocatorDebug::AllocatorFree whereby it would erroneously assert that heap validation failed.</li>
  <li> Fixed bug in GeneralAllocatorDebug::ValidateHeap whereby the validation of a mapped memory chunk could misread the chunk pointer.</li>
  <li> Fixed bug in GeneralAllocator::MallocAlignedInternal whereby the mnPriorSize of mapped memory chunks (as opposed to regular chunks) was not being set.</li>
  <li> Fixed bug in GeneralAllocator::CheckMMappedChunk whereby the pMMappedChunk was incorrect.</li>
  <li> Fixed bug in GameCube GeneralAllocatorDebug's GetCallStack function which would misread the stack.</li>
  <li> Fixed bug whereby if you used GeneralAllocator but not GeneralAllocatorDebug and you called GeneralAllocator::DescribeChunk, it wouldn't append a newline (as it was implicitly assuming that the user was using GeneralAllocatorDebug, which would append it).</li>
  <li> Fixed bug in GeneralAllocatorDebugWin32's DescribeData() (which is currently an unused and undocumented utility function) to deal with the user supplying too small of a buffer.</li>
</ul>
<p>Changes
</p>
<ul>
  <li>Updated the code to be compatible with PS3 SDK v050 (the newest as of this writing).</li>
  <li> GeneralAllocator::ValidateAddress used to return bool. Now it returns void* instead. It is essentially backwards compatible, as a NULL return value means the same thing as false from before. The new version merely provides additional information.</li>
  <li> Modified GeneralAllocatorDebug::Malloc() to use less stack space. It turns out that the PS3 implements some system callbacks in such a way that they give you rather little stack space to work with. This is an attempt to help deal with this limitation.</li>
  <li> Made a few GeneralAllocatorDebug functions const where they weren't previously.</li>
  <li> Increased the size of the temp buffer used by Win32 DescribeCallStack.</li>
  <li> Increased kDefaultTrimThreshold from 128K to 256K.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;"></span>
<p><span style="font-weight: bold;">Version 1.06.00</span> (November 7, 2005)</p>
<p>Additions </p>
<ul>
    <li>&lt;none&gt;</li>
</ul>
<p>Bug Fixes </p>
<ul>
  <li>Fixed the time calculation code in GeneralAllocatorDebug to work with PS3 SDK 040 and later.</li>
  <li> Fix for bogus assert that could have occurred during GeneralAllocatorDebug::Realloc. The code was executing fine, but there was an assert that mistakenly though things weren't fine.</li>
</ul>
<p>Changes </p>
<ul>
  <li>Removed TestSpeed.dsp/dsw. These are VC6 projects which are of no use to us. Similarly, removed TestGeneralAllocator PS3 make files, which are of no use any more.</li>
  <li> Disabled compiler warnings under VC++ / XBox 360 caused by recent versions of xtl.h which cause warnings. Only xtl.h-generated warnings are disabled.</li>
  <li> Some unnecessary build configurations were removed from the Xenon vcproj-based TestGeneralAllocator unit test project.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;">Version 1.05.00</span> (September 21, 2005)<br>
<br>
Additions
<ul>
  <li> StackAllocator now has an option to use named allocations. This is useful for debugging as it allows you to recognized allocations in your general heap that come from a StackAllocator.</li>
  <li> StackAllocator bookmarks are more flexible and efficient now. Functionality should be entirely backward compatible. Users are no longer limited to a fixed number of bookmarks.</li>
  <li> kHookTypeCoreAlloc / kHookTypeCore free hooks are now available. These are useful for setting memory protection flags on core memory of a heap, for example.</li>
  <li> CircularAllocator.cpp added to examples directory. This is a demonstration of how to implement a FIFO allocator, as opposed to StackAllocator (or linear allocator) which is a LIFO allocator.</li>
  <li> Added a comment to every assert in GeneralAllocator.cpp and GeneralAllocatorDebug.cpp explaining what the assert means to the user. This was done because some users were complaining that an assert would fail and the didn't know how to interpret. In practice, when an assert fails it is almost always due to the user corrupting the heap, but we put explanations for them in the source code to assure the user.</li>
  <li> GeneralAllocatorDebug::ValidateHeap: Added an additional validation test.</li>
  <li> Added a few FAQ entries: <br>
  <font face="Courier New, Courier, mono">&nbsp;</font><font face="Courier New, Courier, mono">&nbsp;</font>  How do I take advantage of large pages in Windows or XBox 360? <br>
  <font face="Courier New, Courier, mono">&nbsp;</font><font face="Courier New, Courier, mono">&nbsp;</font>  How can I debug memory leaks?</li>
  <li> Updated documenation for the ReportHeap function.</li>
  <li> Added example code in the examples directory for how to do a page-protection memory error-detecting allocator.</li>
  <li> GeneralAllocator HookInfo now has a GeneralAllocator* pointer so that the user doesn't have to use the pContext parameter for this purpose.</li>
  <li> GeneralAllocatorDebug allocation metrics now have: <br>
    <font face="Courier New, Courier, mono">&nbsp;&nbsp;&nbsp;&nbsp;mnAllocationCountMax;&nbsp;&nbsp;// High water mark of concurrent allocation count. <br>
  &nbsp;&nbsp;&nbsp;&nbsp;mnAllocationVolumeMax;&nbsp;// High water mark of concurrent allocation volume.</font></li>
  <li> Added 'bool bNetSize' argument to GeneralAllocator::GetBlockSize in order to make user-level block size calculations reflect net memory usage better.</li>
  <li> kAllocationFlagPerm defined as a synonym for kAllocationFlagHigh. It seems that despite the documentation saying that high means permanent, there are a number of users that are used to thinking of high as being temporary and didn't notice the documentation for kAllocationFlagHigh.</li>
</ul>
<p>Bug Fixes
</p>
<ul>
  <li>Moved some mutex-using code to within #ifdef PPM_THREAD_SAFETY_SUPPORTED.</li>
  <li> Mutex protection added for GetLargestFreeBlock, GetUsableSize and GetBlockSize.</li>
  <li> HookFuncton fixed to be spelled HookFunction, with backwards compatibility kept.</li>
  <li> kAllocationFlagMMap now lets you ignore heap restrictions on mapped memory counts and sizes.</li>
  <li> Switched some usage of (char*) casts to (uintptr_t) in order to prevent possible compiler warnings.</li>
  <li> GeneralAllocatorDebug will now clear its delayed free list if memory becomes exhausted.</li>
  <li> Fixed bug in Win32 call stack mechanism whereby it could shut down before the user was finished with it. It now allows the user to explicitly init and shut down the callstack mechanism. The problem occured if the user had memory leaks and they had GeneralAllocator explicitly set to shutdown after other modules.</li>
  <li> Fixed a GeneralAlloatorDebug bug whereby the pointer validation feature would generate bogus asserts under some configuration settings.</li>
  <li> Fixed bug in GeneralAllocatorDebug whereby ValidateAddress could recurse infinitely if the bPointerIsAllocation was set to false.</li>
  <li> GeneralAllocator fixed bug whereby 4 bytes more than the user requested could be allocated if the allocation is re-tryed after heap exhaustion and user-replenishment. </li>
</ul>
Changes
<ul>
  <li>Converted all header and source files to 4 spaces per indent instead of 3. </li>
</ul>
<p></p>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.04.00</span> (June 08, 2005)</p>
<p>Additions
</p>
<ul>
  <li> PS3 (PlayStation 3) PU and SPU support. This functionality has not been fully tested yet and may require some maintenance in the future. However, the unit tests for GeneralAllocator and GeneralAllocatorDebug succeed.</li>
  <li> kAllocationFlagMMap added as per an identified need for Xenon and PC platforms.</li>
  <li> More FAQ entries added, based on user feedback. </li>
  <li> StackAllocator Reset function added. It clears allocations and bookmarks.</li>
  <li> Added IsAllocationHigh to GeneralAllocator, as there was no means of telling a high from a low block.</li>
</ul>
Bug Fixes
<ul>
    <li>      Robustified GetCallStack() in EAGeneralAllocatorDebugPS2.cpp to deal with the user having a different crt0.s file. This change was implemented by Simon Everett.</li>
    <li>      Fixed bug in GeneralAllocator.cpp whereby if the user defined PPM_THREAD_SAFETY_SUPPORTED to be zero (i.e. disabled the support of threading) there would be compiler errors due to code that references some variables. </li>
    <li>      Fixed bug in GeneralAllocatorDebug whereby if you exhausted the heap and had pointer validation enabled it would crash or report the heap as corrupted when it really wasn't. The problem was that some calls to AllocatorMalloc weren't being checked for their return value in GeneralAllocatorDebug.</li>
    <li> Fixed bogus assert in GeneralAllocatorDebug which was recently introduced (didn't exist in at least v1.0 and v1.1) which would occur if pointer validation and delayed frees were enabled at the same time.</li>
</ul>
Changes
<ul>
  <li> Builds as a Framework 2 package using eaconfig </li>
  <li>Class EA::Allocator::GeneralAllocatorInterface has been removed from the built library. If you want to use that class, it will be necessary to modify the library buildfile to build class the source file eaallocatorinterface.cpp. This change was done so next-gen titles do not need to use the Allocator package in their build process. Next-Gen titles should be using the ICoreAllocator interface for memory management.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;">Version 1.03.01</span> (Mar. 11, 2005)<br>
<br>

Additions
<ul>
  <li><small><span style="font-family: Courier New;"></span></small>&lt;none&gt;</li>
</ul>
<p>Bug Fixes</p>
<ul>
  <li> On console platforms, if you ran out of memory and had some system memory available to allocate, but not enough system memory for how much you want, GeneralAllocator could in some cases would allocate the insufficient amount of system memory but report success. This could affect debug/development builds, but not release/shipping builds. The bug only manifests if all memory has become exhausted, so in practice the application would usually crash anyway.</li>
  <li> Robustified the chunk describing mechanism. It should be safe against overflows regardless of how big the chunk tag data is or how small the passed in description buffer is. The chunk describing mechanism has also been made a little more efficient.</li>
  <li> Robustified GetChunkIsFenceChunk to deal with user passing in a bad pointer.</li>
</ul>
<p>Changes </p>
<ul>
  <li>&lt;none&gt;</li>
</ul>
<p></p>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.3.0 (equivalent to 1.03.00)</span> (Jan. 12, 2005)</p>
<p> Additions </p>
<ul>
  <li> EA::Allocator::GetCallStack working again on the Xenon platform.</li>
  <li> Added detailed documentation for the Malloc and Free functions. Some users have not been sure about some things, such as what happens if you Malloc zero bytes.</li>
  <li> GeneralAllocatorDebug now enables pointer validation by default for PPM_DEBUG &gt;= 2. Based on the design and documentation of PPM_DEBUG, this pointer validation would be expected. The user can always disable it, but the user probably wouldn't want to.</li>
  <li> ReportHeap and TakeSnapshot now allow you to filter away internal blocks. This allows heap reporting functions to ignore internal blocks. See the kBlockTypeInternal enumeration in class GeneralAllocator.</li>
</ul>
<p> Bug Fixes</p>
<ul>
  <li> Added line to GeneralAllocatorDebug::Malloc to check for integer overflow. If the user tried to allocate something 4GB of memory, this would catch the error. GeneralAllocator was already protected against such things.</li>
  <li> A typo in GeneralAllocatorDebug::DoFailureNotification was causing the message buffer to not show as much as most users would like and as much as was intended. It has been changed to the intended value.</li>
  <li> StackAllocator::MallocAligned fixed to obey minimum alignment expectations.</li>
  <li> StackAllocator::Malloc fixed to deal with the (unusual) case of address overflow.</li>
</ul>
<p>Changes</p>
<ul>
  <li> Stack reporting code for PS2 replaced with version submitted by Simon Everett. The new version is more flexible and more reliable. It is based on code that has been in production at EARS for some time.</li>
  <li> Macro for determining whether to create export symbols has been changed from _DLL to EA_DLL. This macro is supplied by tlconfig when a DLL is being built. _DLL is defined by the compiler when /MD or /MDd is passed on the compiler command line.</li>
</ul>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.2.0 (equivalent to 1.02.00)</span> (Nov. 3, 2004)</p>
<p> Additions </p>
<ul>
  <li> GetLargestFreeBlock function added to GeneralAllocator class. Refer to documentation for details.</li>
  <li> PPMMutexGetLockCount function added. Refer to documentation for details.</li>
  <li> PPMalloc is now available as a DLL. To build it, set a property called Dll to true. The DLLs and PDBs will be placed in ./bin/pc and the import library will be placed in ./lib/pcdll.</li>
  <li> GetVersion and CheckVersion functions added to verify that the correct version of the library has been loaded by the O/S (in the case of a DLL) or linked (in the case of a static library).</li>
</ul>
<p> Bug Fixes</p>
<ul>
  <li> A bug in GeneralAllocator::ChunkMatchesLowHigh has been fixed. This allows better allocation during very low memory conditions and provides for higher performance under some conditions.</li>
  <li>A bug has been fixed in GeneralAllocator::AddCore for when the user specified that they wanted new core of a given size but didn't specify an actual pointer to core.</li>
</ul>
<p>Changes</p>
<ul>
  <li> Updated default tlconfig dependency to 1.00.12.</li>
</ul>
<p></p>
<hr style="width: 100%; height: 2px;">
<p><span style="font-weight: bold;">Version 1.1.0 (equivalent to 1.01.00)</span> (Aug. 24, 2004)</p>
<p> Bug Fixes </p>
<ul>

  <li>
    A compilation bug for EA_PLATFORM_UNIX has been fixed (see change list #23233).
  </li>

  <li>
    A MSVC/Win32 code generation bug has been worked around (see change list #21327, GeneralAllocator::Shutdown).
  </li>
  <li>
    A bogus assert about memory fills has been fixed (see change list #21516, MallocAlignedInternal).
  </li>
  <li>
    A Win32 bug related to core trimming has been fixed (see change list #21497, GeneralAllocator::TrimCore).
  </li>
  <li>A bug in GeneralAllocatorDebug::kDebugDataIdAllocationCount usage has been fixed.</li>
</ul>

Changes

<ul>

  <li>    Updated default tlconfig dependency to 1.00.10.</li>

  <li>    Warnings 4525 and 4526 are not disabled on PC, Xbox, and Xenon any longer.</li>
  <li>    Documenation has been enhanced (multiple change lists).</li>
  <li>    PPM_DEBUG_FILL setting now available for better control over internal consistency checking (change list #23511).</li>
  <li>    PPM_DEBUG levels have been modified so that PPM_DEBUG = 1 has higher performance but does less internal checking; you can use PPM_DEBUG = 2+ to obtain more automatic internal checking. Also, PPM_DEBUG levels are now explained in detail in the documentation (change list #23511).</li>
  <li>    The GetBlockSize function has been added (change list #22415).</li>
  <li>    AllocationRecorder now has thread safety built-in (change list #21497).</li>
  <li>    GeneralAllocatorDebug guard fills have been improved (change list #23433). </li>
  <li>GeneralAllocatorDebug records the minimum supported alignment instead of zero when the user specifies an alignment of zero (change list #22689).</li>
  <li>GeneralAllocatorDebug::SetFillValues can now be called at any time and not only before the first allocation has occurred (change list #22415).</li>
  <li>GeneralAllocatorDebug's data map is disabled unless explicitly enabled.</li>
  <li>GeneralAllocatorDebug's metrics tracking is disabled unless explicitly enabled.</li>
  <li>GeneralAllocator now lets you explicitly clear the cache with ClearCache().</li>
</ul>

<hr style="width: 100%; height: 2px;">
<span style="font-weight: bold;">Version 1.00.00</span> (June 8, 2004)<br>
<p>Release Notes</p>
<ul>

  <li>Initial public release.</li>

</ul>

<hr style="width: 100%; height: 2px;">
End of document<br>

<br>

<br>

<p>&nbsp; </p>
</body>
</html>
